# Written by: Esha Joshi
# Description: Combines benchmark TSVs generated by Snakemake into one file 
# and appends the rule name and process name for plotting 

# load in required libraries
library(tidyverse)

# function to read tsv input and append rule name and process
read_benchmarks <- function(filename) {
  read_tsv(filename) %>%
    mutate( 
      process = gsub("*.tsv","",basename(filename)),
      rule =  basename(dirname(filename))
      )
}

# run function for all specified snakemake inputs and output benchmarks tsv
dataset <- snakemake@input[["tsv"]] %>%
  lapply(read_benchmarks) %>%
  bind_rows()
head(dataset)
write_tsv(dataset, snakemake@output[['benchmarks']])